@model AspCoreFirstApp.ViewModels.PaginatedListViewModel<AspCoreFirstApp.Models.Movie>

@{
    ViewData["Title"] = "Liste des Films";
    ViewBag.SortBy = Model.SortBy;
    ViewBag.SortOrder = Model.SortOrder;
}

<div class="container mt-4">
    <div class="row mb-4 align-items-center">
        <div class="col-md-6">
            <h1 class="mb-0">@ViewData["Title"]</h1>
        </div>
        <div class="col-md-6 text-end">
            <a href="@Url.Action("Create", "Movie")" class="btn btn-primary btn-lg"
                aria-label="Ajouter un nouveau film">
                <i class="bi bi-plus-circle me-2" aria-hidden="true"></i>Ajouter un film
            </a>
        </div>
    </div>

    ```
    <!-- Search and Filter Bar -->
    <div class="row mb-3">
        <div class="col-md-8">
            <form method="get" class="d-flex">
                <input type="text" name="search" value="@Context.Request.Query["search"]" class="form-control me-2"
                    placeholder="Rechercher par nom ou genre..." aria-label="Rechercher des films">
                <button type="submit" class="btn btn-outline-secondary" aria-label="Lancer la recherche">
                    <i class="bi bi-search" aria-hidden="true"></i> Rechercher
                </button>
            </form>
        </div>
        <div class="col-md-4 text-end">
            @if (Model.Genres != null && Model.Genres.Any())
            {
                <select class="form-select"
                    onchange="location.href='@Url.Action("Index", "Movie")' + '?genre=' + this.value;">
                    <option value="">Tous les genres</option>
                    @foreach (var genre in Model.Genres)
                    {
                        <option value="@genre.Id" selected="@(Context.Request.Query["genre"] == genre.Id.ToString())">
                            @genre.Name
                        </option>
                    }
                </select>
            }
        </div>
    </div>

    @if (Model.Items.Any())
    {
        <div class="table-responsive position-relative">
            <table class="table table-striped table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th scope="col" style="width: 150px;">Affiche</th>
                        <th scope="col">
                            <a href="@Url.Action("Index", "Movie", new { sortBy = "Name", sortOrder = Model.SortOrder == "asc" && Model.SortBy == "Name" ? "desc" : "asc", search = Context.Request.Query["search"], genre = Context.Request.Query["genre"] })"
                                class="text-white text-decoration-none"
                                title="Trier par nom @(Model.SortOrder == "asc" && Model.SortBy == "Name" ? "décroissant" : "croissant")"
                                aria-label="Trier par nom">
                                Nom
                                @if (Model.SortBy == "Name")
                                {
                                    <i class="bi @(Model.SortOrder == "asc" ? "bi-sort-up" : "bi-sort-down") ms-1"
                                        aria-hidden="true"></i>
                                }
                            </a>
                        </th>
                        <th scope="col">Genre</th>
                        <th scope="col" class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var movie in Model.Items)
                    {
                        <tr>
                            <!-- Affiche column -->
                            <td>
                                <img src="@Url.Content("~/images/" + movie.ImageFile)" alt="@movie.Name"
                                    style="width: 120px; height: 180px; object-fit: cover;" />
                            </td>
                            <!-- Name column -->
                            <td class="fw-semibold">@movie.Name</td>
                            <!-- Genre column -->
                            <td>@(movie.Genre?.Name ?? "Non défini")</td>
                            <!-- Actions column -->
                            <td class="text-center">
                                <div class="btn-group" role="group" aria-label="Actions pour @movie.Name">
                                    <a href="@Url.Action("Details", "Movie", new { id = movie.Id })" class="btn btn-sm btn-info"
                                        data-bs-toggle="tooltip" title="Voir les détails" aria-label="Détails de @movie.Name">
                                        <i class="bi bi-eye" aria-hidden="true"></i> Détails
                                    </a>
                                    <a href="@Url.Action("Edit", "Movie", new { id = movie.Id })" class="btn btn-sm btn-warning"
                                        data-bs-toggle="tooltip" title="Éditer le film" aria-label="Éditer @movie.Name">
                                        <i class="bi bi-pencil" aria-hidden="true"></i> Éditer
                                    </a>
                                    <a href="@Url.Action("Delete", "Movie", new { id = movie.Id })"
                                        class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal"
                                        data-movie-name="@movie.Name" data-movie-id="@movie.Id" data-bs-toggle="tooltip"
                                        title="Supprimer le film" aria-label="Supprimer @movie.Name">
                                        <i class="bi bi-trash" aria-hidden="true"></i> Supprimer
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        @await Html.PartialAsync("_Pagination", Model.Pagination)
    }
    else
    {
        <div class="alert alert-info text-center" role="alert">
            <i class="bi bi-info-circle fs-1 mb-2" aria-hidden="true"></i>
            <h4 class="alert-heading">Aucun film disponible</h4>
            <p>Il n'y a pas de films correspondant à votre recherche. Essayez de modifier vos filtres ou
                <a href="@Url.Action("Create", "Movie")" class="alert-link">ajoutez-en un nouveau</a>.
            </p>
        </div>
    }
    ```

</div>

<!-- Delete Confirmation Modal -->

<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirmer la suppression</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
            </div>
            <div class="modal-body">
                Êtes-vous sûr de vouloir supprimer le film "<span id="movieName"></span>" ? Cette action est
                irréversible.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                <a id="deleteLink" href="#" class="btn btn-danger">Supprimer</a>
            </div>
        </div>
    </div>
</div>

<style>
    .table-hover tbody tr:hover {
        background-color: #f8f9fa;
        transition: background-color 0.2s ease;
    }

    a {
        text-decoration: none;
        transition: color 0.2s ease;
    }

    th a {
        color: white;
    }

    th a:hover {
        color: #e0e0e0;
    }

    .btn-group .btn {
        margin-right: 0.25rem;
    }

    .btn-group .btn:last-child {
        margin-right: 0;
    }

    .table-responsive::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.8);
        display: none;
        z-index: 10;
    }

    .table-responsive.loading::before {
        display: block;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.map(function (tooltipTriggerEl) { return new bootstrap.Tooltip(tooltipTriggerEl); });

        // Delete modal
        var deleteModal = document.getElementById('deleteModal');
        deleteModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            var movieName = button.getAttribute('data-movie-name');
            var movieId = button.getAttribute('data-movie-id');
            var modalBody = deleteModal.querySelector('.modal-body #movieName');
            var deleteLink = deleteModal.querySelector('#deleteLink');

            modalBody.textContent = movieName;
            deleteLink.href = '@Url.Action("Delete", "Movie")' + '?id=' + movieId;
        });
    });
</script>